#!/bin/bash

set -eu -o pipefail

global_dir="$XDG_TOOLCHAINS_HOME/python/global"
requirements_file="$global_dir/requirements.txt"

mkdir -p "$global_dir"
touch "$requirements_file"

"${EDITOR:-vi}" "$requirements_file"

if [ -s "$requirements_file" ]; then
  tmpdir="$(mktemp -d)"
  trap 'rm -rf "$tmpdir"' EXIT
  env -u VIRTUAL_ENV uv run --directory "$tmpdir" --no-project --with-requirements "$requirements_file" -- python -c 'pass'
fi
