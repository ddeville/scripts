#!/bin/bash

set -eu -o pipefail

BASE="$(git symbolic-ref refs/remotes/origin/HEAD 2>/dev/null | sed 's@^refs/remotes/origin/@@')"
HEAD="$(git branch --show-current)"

OUTPUT="$(mktemp /tmp/gh-pr-create.XXXXXX)"

gh pr create --base="$BASE" --head="$HEAD" --fill | tee "$OUTPUT"

if url=$(grep -Eo 'https://github\.com/[[:alnum:]/._-]+/pull/[0-9]+' "$OUTPUT" | head -n1); then
  open "$url"
fi
