#!/bin/sh

# kill the current running instances
pgrep -x sxhkd > /dev/null || sxhkd &

# set up nitrogen
nitrogen --restore &

# tweak screen color to be easier on eyes
redshift -P -O 4500

# get the right hwmon path to monitor CPU temp in polybar
cpu_label="k10temp: Tdie"
for i in /sys/class/hwmon/hwmon*/temp*_input; do
    if [ "$(<$(dirname $i)/name): $(cat ${i%_*}_label 2>/dev/null || echo $(basename ${i%_*}))" = "$cpu_label" ]; then
        export HWMON_PATH="$i"
    fi
done

# set up polybar
killall -q polybar
while pgrep -u $UID -x polybar >/dev/null; do sleep 1; done
mkdir -p $HOME/.cache/logs
polybar main 2> $HOME/.cache/logs/polybar-main.err &
polybar term 2> $HOME/.cache/logs/polybar-term.err &

bspc monitor DisplayPort-0 -d web media dbx zoom a b
bspc monitor DisplayPort-1 -d code dbx-code c d

bspc config border_width 2
bspc config window_gap 0
bspc config focused_border_color \#ff8c00
bspc config split_ratio 0.52
bspc config borderless_monocle false
bspc config gapless_monocle false

bspc rule -a Slack desktop='dbx' follow=on
bspc rule -a Spotify desktop='media' follow=on
bspc rule -a discord desktop='media' follow=on
bspc rule -a zoom desktop='zoom' state=floating follow=on
bspc rule -a 1Password state=floating
